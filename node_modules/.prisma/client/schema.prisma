generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  createdAt DateTime @default(now())
  password  String
  role      Role     @default(USER)
  atletas   Atleta[] // relação com atletas
}

model Atleta {
  id             String   @id @default(uuid())
  nome           String
  dataNascimento DateTime
  categoria      String?
  genero         String?
  fone           String?
  fotoUrl        String?
  usuarioId      String
  usuario        User     @relation(fields: [usuarioId], references: [id])
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  partidasComoAtleta1 Partida[] @relation("Atleta1")
  partidasComoAtleta2 Partida[] @relation("Atleta2")
  partidasComoAtleta3 Partida[] @relation("Atleta3")
  partidasComoAtleta4 Partida[] @relation("Atleta4")
}

enum Role {
  ADMIN
  USER
  ORGANIZER
}

model Torneio {
  id         String    @id @default(uuid())
  nome       String
  dataInicio DateTime
  dataFim    DateTime?
  partidas   Partida[]
}

model Partida {
  id    String   @id @default(uuid())
  data  DateTime
  local String

  atleta1   Atleta @relation("Atleta1", fields: [atleta1Id], references: [id])
  atleta1Id String

  atleta2   Atleta @relation("Atleta2", fields: [atleta2Id], references: [id])
  atleta2Id String

  atleta3   Atleta? @relation("Atleta3", fields: [atleta3Id], references: [id])
  atleta3Id String?

  atleta4   Atleta? @relation("Atleta4", fields: [atleta4Id], references: [id])
  atleta4Id String?

  gamesTime1         Int?
  gamesTime2         Int?
  tiebreakTime1      Int?
  tiebreakTime2      Int?
  supertiebreakTime1 Int?
  supertiebreakTime2 Int?

  torneioId String?
  torneio   Torneio? @relation(fields: [torneioId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum FormatoPartida {
  SET_UNICO // até 6 games + tiebreak até 7
  ITF
}
